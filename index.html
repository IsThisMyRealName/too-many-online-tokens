<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Too-Many-Tokens-DND</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <script type="text/javascript" src="jszip.min.js"></script>
  <script type="text/javascript" src="FileSaver.min.js"></script>

</head>

<body>
  <div class="container">
    <label for="txtFiles">Show too many tokens for:</label>
    <div class="dropdown-container">
      <!-- <select id="txtFiles" class="select-search"></select> -->
      <div id="txtFilesSearch" class="dropdown-content">
        <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()" onfocus="toggleDropdownShow(true)">
      </div>
    </div>
    <button id="showImagesBtn" disabled>Show too many tokens</button>
    <button id="downloadImagesBtn" style="display:none;">Download Images</button>
    <div id="imagesContainer" class="images-container"></div>    
  </div>

  <script>
      // Define the base URL for image paths
      const baseUrl =
        "https://raw.githubusercontent.com/IsThisMyRealName/too-many-tokens-dnd/main/";

      

      // Function to fetch image paths from a selected .txt file
      async function fetchImagePaths(fileName) {
        const response = await fetch('link-files/' + fileName);
        const lines = await response.text();
        return lines
          .split("\n")
          .filter((line) => line.trim().endsWith(".webp"));
      }

      // Function to display images
      async function showImages() {
        const selectedFileName = document.getElementById("myInput").value;
        const imagePaths = await fetchImagePaths(`${selectedFileName}.txt`);

        const imagesContainer = document.getElementById("imagesContainer");
        imagesContainer.innerHTML = ""; // Clear previous images

        imagePaths.forEach((path) => {
          const img = document.createElement("img");
          img.src = baseUrl + selectedFileName.replace(" ", "%20") + "/" + path;
          img.title = path;
          img.width = 256;
          img.height = 256;
          img.onclick = function () { copyImageLink(img.src) };
          imagesContainer.appendChild(img);
        });

        // Show the download button if images are shown
        if (imagePaths.length > 0) {
          document.getElementById("downloadImagesBtn").style.display = "block";
        } else {
          document.getElementById("downloadImagesBtn").style.display = "none";
        }
      }

      // Initialize dropdown with .txt files
      fetchTxtFiles().then((txtFiles) => {
        // const dropdown = document.getElementById("txtFiles");
        const textSearchDropdown = document.getElementById("txtFilesSearch");
        txtFiles.forEach((fileName) => {
          const option = document.createElement("a");
          option.value = fileName;
          option.text = fileName.split(".")[0].replace("%20", " "); // Remove .txt extension
          
          // dropdown.appendChild(option);
          textSearchDropdown.appendChild(option);
          option.onclick = function() {applyTextToInput(option.text)}; 
        });
        toggleDropdownShow(false);
      });

      

      // Add event listener to the button
      document
        .getElementById("showImagesBtn")
        .addEventListener("click", showImages);

      // // Enable button when a file is selected
      // document
      //   .getElementById("txtFilesSearch")
      //   .addEventListener("change", function () {
      //     document.getElementById("showImagesBtn").disabled = false;
      //   });

        /* When the user clicks on the button,
  toggle between hiding and showing the dropdown content */
          function toggleDropdownShow(shouldShow) {
            const textFileSearch = document.getElementById("txtFilesSearch");
            
            if (shouldShow) {
              filterFunction();
            }
            else {
              var a = textFileSearch.getElementsByTagName("a");
              for (i = 0; i < a.length; i++) {
                a[i].style.display = "none";
              }
            }
          }

          function applyTextToInput(text) {
              document.getElementById("myInput").value = text;
              document.getElementById("showImagesBtn").disabled = false;
              toggleDropdownShow(false);
            };

          function filterFunction() {
            var input, filter, ul, li, a, i;
            input = document.getElementById("myInput");
            filter = input.value.toUpperCase();
            div = document.getElementById("txtFilesSearch");
            a = div.getElementsByTagName("a");
            for (i = 0; i < a.length; i++) {
              txtValue = a[i].textContent || a[i].innerText;
              if (txtValue.toUpperCase().indexOf(filter) > -1) {
                a[i].style.display = "";
              } else {
                a[i].style.display = "none";
              }
            }
            document.getElementById("showImagesBtn").disabled = true;
          } 

          // Function to copy the image link
            function copyImageLink(imageLink) {
              // Create a temporary input element
              var tempInput = document.createElement("input");

              // Set the input value to the image link
              tempInput.value = imageLink;

              // Append the input element to the body
              document.body.appendChild(tempInput);

              // Select the input element's value
              tempInput.select();

              // Copy the selected value
              document.execCommand("copy");

              // Remove the temporary input element
              document.body.removeChild(tempInput);

              // Optionally, provide feedback to the user
               new Notification("Image link copied to clipboard: " + imageLink);
            }

            // Function to download images as a zip file
              document.getElementById("downloadImagesBtn").addEventListener("click", async function () {
                const images = document.getElementById("imagesContainer").getElementsByTagName("img");
                const zip = new JSZip();
                // const imgFolder = zip.folder(`images ${document.getElementById("myInput").value}`);

                for (let i = 0; i < images.length; i++) {
                  const image = images[i];
                  const imageName = image.title.slice(0, -1);;
                  const imageUrl = image.src;

                  // await imgFolder.file(imageName, imageBlob);
                    console.log(i)
                    var imageFetch = await fetch(imageUrl)
                    var imageBlob = await imageFetch.blob()
                    // var img = zip.folder("images");
                    // loading a file and add it in a zip file
                    zip.file(imageName, imageBlob, { binary: true });
                }

                zip.generateAsync({ type: "blob" })
                  .then(content => {
                    saveAs(content, `${document.getElementById("myInput").value}.zip`);
                  });
              });

  // Function to fetch .txt files in a folder
  async function fetchTxtFiles() {
    const veryStupidHardcodeTextfiles = [
      "Aarakocra",
      "Aboleth",
      "Abominable Yeti",
      "Acolyte",
      "Air Elemental",
      "Allosaurus",
      "Animated Armor",
      "Ankheg",
      "Ankylosaurus",
      "Ape",
      "Assassin",
      "Awakened Shrub",
      "Awakened Tree",
      "Axe Beak",
      "Azer",
      "Baboon",
      "Badger",
      "Bandit Captain",
      "Bandit",
      "Banshee",
      "Barbed Devil",
      "Barlgura",
      "Basilisk",
      "Bat",
      "Bearded Devil",
      "Beholder Zombie",
      "Berserker",
      "Black Bear",
      "Black Dragon Wyrmling",
      "Black Pudding",
      "Blink Dog",
      "Blood Hawk",
      "Blue Dragon Wyrmling",
      "Blue Slaad",
      "Boar",
      "Bone Devil",
      "Bone Naga",
      "Brass Dragon Wyrmling",
      "Bronze Dragon Wyrmling",
      "Brown Bear",
      "Bugbear Chief",
      "Bugbear",
      "Bulette",
      "Bullywug",
      "Cambion",
      "Camel",
      "Carrion Crawler",
      "Cat",
      "Cave Bear",
      "Centaur",
      "Chain Devil",
      "Chasme",
      "Chimera",
      "Chuul",
      "Clay Golem",
      "Cloaker",
      "Cloud Giant",
      "Cockatrice",
      "Commoner",
      "Constrictor Snake",
      "Copper Dragon Wyrmling",
      "Couatl",
      "Crab",
      "Crawling Claw",
      "Crocodile",
      "Cult Fanatic",
      "Cultist",
      "Cyclops",
      "Darkmantle",
      "Death Dog",
      "Death Slaad",
      "Deep Gnome",
      "Deer",
      "Deva",
      "Dire Wolf",
      "Displacer Beast",
      "Doppelganger",
      "Draft Horse",
      "Dretch",
      "Drider",
      "Drow Elite Warrior",
      "Drow Mage",
      "Drow Priestess of Lolth",
      "Drow",
      "Druid",
      "Dryad",
      "Duergar",
      "Duodrone",
      "Dust Mephit",
      "Eagle",
      "Earth Elemental",
      "Elephant",
      "Elk",
      "Ettercap",
      "Ettin",
      "Faerie Dragon",
      "Fire Elemental",
      "Fire Giant",
      "Fire Snake",
      "Flameskull",
      "Flesh Golem",
      "Flumph",
      "Flying Snake",
      "Flying Sword",
      "Fomorian",
      "Frog",
      "Frost Giant",
      "Galeb Duhr",
      "Gargoyle",
      "Gas Spore",
      "Gelatinous Cube",
      "Ghast",
      "Ghost",
      "Ghoul",
      "Giant Ape",
      "Giant Badger",
      "Giant Bat",
      "Giant Boar",
      "Giant Centipede",
      "Giant Constrictor Snake",
      "Giant Crab",
      "Giant Crocodile",
      "Giant Eagle",
      "Giant Elk",
      "Giant Fire Beetle",
      "Giant Frog",
      "Giant Goat",
      "Giant Hyena",
      "Giant Lizard",
      "Giant Octopus",
      "Giant Owl",
      "Giant Poisonous Snake",
      "Giant Rat",
      "Giant Scorpion",
      "Giant Seahorse",
      "Giant Shark",
      "Giant Spider",
      "Giant Toad",
      "Giant Vulture",
      "Giant Wasp",
      "Giant Weasel",
      "Giant Wolf Spider",
      "Gibbering Mouther",
      "Githyanki Knight",
      "Githyanki Warrior",
      "Githzerai Monk",
      "Githzerai Zerth",
      "Glabrezu",
      "Gladiator",
      "Gnoll Fang of Yeenoghu",
      "Gnoll Pack Lord",
      "Gnoll",
      "Goat",
      "Goblin Boss",
      "Goblin",
      "Gold Dragon Wyrmling",
      "Gorgon",
      "Gray Ooze",
      "Gray Slaad",
      "Green Dragon Wyrmling",
      "Green Hag",
      "Green Slaad",
      "Grell",
      "Griffon",
      "Grimlock",
      "Guard",
      "Guardian Naga",
      "Half-Ogre",
      "Harpy",
      "Hawk",
      "Hellhound",
      "Helmed Horror",
      "Hezrou",
      "Hill Giant",
      "Hippogriff",
      "Hobgoblin Captain",
      "Hobgoblin Warlord",
      "Hobgoblin",
      "Homunculus",
      "Hook Horror",
      "Hunter Shark",
      "Hydra",
      "Hyena",
      "Ice Mephit",
      "Imp",
      "Incubus",
      "Intellect Devourer",
      "Invisible Stalker",
      "Jackal",
      "Jackalwere",
      "Kenku",
      "Killer Whale",
      "Knight",
      "Kobold",
      "Kuo-toa Archpriest",
      "Kuo-toa Monitor",
      "Kuo-toa Whip",
      "Kuo-toa",
      "Lamia",
      "Lemure",
      "Lion",
      "Lizard King",
      "Lizard Queen",
      "Lizard",
      "Lizardfolk Shaman",
      "Lizardfolk",
      "Mage",
      "Magma Mephit",
      "Magmin",
      "Mammoth",
      "Manes",
      "Manticore",
      "Mastiff",
      "Medusa",
      "Merfolk",
      "Merrow",
      "Mezzoloth",
      "Mimic",
      "Mindflayer Arcanist",
      "Mindflayer",
      "Minotaur Skeleton",
      "Minotaur",
      "Monodrone",
      "Mud Mephit",
      "Mule",
      "Mummy",
      "Myconid Adult",
      "Myconid Sovereign",
      "Myconid Sprout",
      "Needle Blight",
      "Night Hag",
      "Nightmare",
      "Noble",
      "Nothic",
      "Nycaloth",
      "Ochre Jelly",
      "Octopus",
      "Ogre Zombie",
      "Ogre",
      "Oni",
      "Orc Eye of Gruumsh",
      "Orc War Chief",
      "Orc",
      "Orog",
      "Owl",
      "Owlbear",
      "Packs",
      "Panther",
      "Pegasus",
      "Pentadrone",
      "Peryton",
      "Phase Spider",
      "Piercer",
      "Pixie",
      "Plesiosaurus",
      "Poisonous Snake",
      "Polar Bear",
      "Poltergeist",
      "Pony",
      "Priest",
      "Pseudodragon",
      "Pteranodon",
      "Quadrone",
      "Quaggoth Thonot",
      "Quaggoth",
      "Quasit",
      "Quipper",
      "Rat",
      "Raven",
      "Red Dragon Wyrmling",
      "Red Slaad",
      "Reef Shark",
      "Revenant",
      "Rhinoceros",
      "Riding Horse",
      "Roper",
      "Rug of Smothering",
      "Rust Monster",
      "Saber-Toothed Tiger",
      "Sahuagin Baron",
      "Sahuagin Priestess",
      "Sahuagin",
      "Salamander",
      "Satyr",
      "Scarecrow",
      "Scorpion",
      "Scout",
      "Scripts",
      "Sea Hag",
      "Sea Horse",
      "Shadow Demon",
      "Shadow",
      "Shambling Mound",
      "Shield Guardian",
      "Shrieker",
      "Silver Dragon Wyrmling",
      "Skeleton",
      "Slaad Tadpole",
      "Smoke Mephit",
      "Spectator",
      "Specter",
      "Spider",
      "Spined Devil",
      "Spirit Naga",
      "Sprite",
      "Steam Mephit",
      "Stirge",
      "Stone Giant",
      "Stone Golem",
      "Succubus",
      "Swarm of Bats",
      "Swarm of Beetles",
      "Swarm of Centipedes",
      "Swarm of Insects",
      "Swarm of Poisonous Snakes",
      "Swarm of Quippers",
      "Swarm of Rats",
      "Swarm of Ravens",
      "Swarm of Spiders",
      "Swarm of Wasps",
      "Thri-kreen",
      "Thug",
      "Tiger",
      "Token",
      "Treant",
      "Tribal Warrior",
      "Triceratops",
      "Tridrone",
      "Troglodyte",
      "Troll",
      "Twig Blight",
      "Tyrannosaurus Rex",
      "Umber Hulk",
      "Unicorn",
      "Vampire Spawn",
      "Veteran",
      "Vine Blight",
      "Violet Fungus",
      "Vrock",
      "Vulture",
      "Warhorse Skeleton",
      "Warhorse",
      "Water Elemental",
      "Water Weird",
      "Weasel",
      "Werebear",
      "Wereboar",
      "Wererat",
      "Weretiger",
      "Werewolf",
      "White Dragon Wyrmling",
      "Wight",
      "Will-o'-Wisp",
      "Winged Kobold",
      "Winter Wolf",
      "Wolf",
      "Worg",
      "Wraith",
      "Wyvern",
      "Yeti",
      "Yochol",
      "Young Black Dragon",
      "Young Blue Dragon",
      "Young Brass Dragon",
      "Young Bronze Dragon",
      "Young Copper Dragon",
      "Young Gold Dragon",
      "Young Green Dragon",
      "Young Red Dragon",
      "Young Remorhaz",
      "Young Silver Dragon",
      "Young White Dragon",
      "Yuan-ti Abomination",
      "Yuan-ti Malison (Type 1)",
      "Yuan-ti Malison (Type 3)",
      "Yuan-ti Pureblood",
      "Zombie",
    ]
    return veryStupidHardcodeTextfiles;
    const response = await fetch('link-files/');
    const txtFile = await response.text();
    const txtFiles = txtFile.split('\n').flatMap(line => line.split(' ')).filter(word => word.trim().endsWith('.txt'));
    return txtFiles;
  }
          
    </script>
  </body>
</html>
